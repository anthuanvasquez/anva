jQuery(function(e){if("undefined"!=typeof plupload&&"undefined"!=typeof ANVAUploaderInit){var t=new plupload.Uploader(ANVAUploaderInit);t.init(),t.bind("FilesAdded",function(e){e.start(),jQuery("#anva_gallery_spinner").css("display","block")}),t.bind("FileUploaded",function(e,a,i){var l=t.total.queued<1?function(){jQuery("#anva_gallery_spinner").hide()}:function(){};"undefined"!=typeof i.response&&n.get_thumbnail(i.response,l)})}else jQuery("#anva-plupload-browse-button").hide();var a,n={admin_thumb_ul:"",admin_thumb_ul_li:"",init:function(){this.admin_thumb_ul=jQuery("#anva_gallery_thumbs"),this.admin_thumb_ul_li=jQuery("#anva_gallery_thumbs li"),this.admin_thumb_ul.sortable({placeholder:"anva_gallery_placeholder"}),this.admin_thumb_ul.on("click",".anva_gallery_remove",function(){return jQuery(this).parent().fadeOut(100,function(){jQuery(this).remove()}),setTimeout(function(){n.empty_gallery()},500),!1}),jQuery("#anva_gallery_upload_button").on("click",function(e){return e.preventDefault(),a?void a.open():(a=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!0}),a.on("select",function(){for(var e=a.state().get("selection").toJSON(),t=e.length,i=0;t>i;i++)n.get_thumbnail(e[i].id)}),void a.open())}),jQuery("#anva_gallery_add_attachments_button").on("click",function(){var e=[];jQuery("#anva_gallery_thumbs input[type=hidden]").each(function(t,a){e.push(jQuery(this).val())}),n.get_all_thumbnails(POST_ID,e)}),jQuery("#anva_gallery_delete_all_button").on("click",function(){return 0==jQuery("#anva_gallery_thumbs li").length?void alert("The box is empty, add some image first."):(confirm("Are you sure you want to delete all the images in the gallery?")&&n.admin_thumb_ul.empty(),n.empty_gallery(),!1)}),n.empty_gallery()},get_thumbnail:function(e,t){t=t||function(){};var a={action:"anva_gallery_get_thumbnail",imageid:e};jQuery("#anva_gallery_spinner").css("display","block"),jQuery.post(ajaxurl,a,function(e){n.admin_thumb_ul.append(e),t(),n.empty_gallery()}).done(function(){jQuery("#anva_gallery_spinner").hide()})},get_all_thumbnails:function(e,t){var a={action:"anva_gallery_get_all_thumbnail",post_id:e,included:t};jQuery("#anva_gallery_spinner").css("display","block"),jQuery.post(ajaxurl,a,function(e){n.admin_thumb_ul.append(e),n.empty_gallery()}).done(function(){jQuery("#anva_gallery_spinner").hide()})},empty_gallery:function(){this.admin_thumb_ul=jQuery("#anva_gallery_thumbs"),this.admin_thumb_ul_li=jQuery("#anva_gallery_thumbs li"),0==this.admin_thumb_ul_li.length?(this.admin_thumb_ul.find("span").remove(),this.admin_thumb_ul.append("<span>No images have been selected yet.<span>")):this.admin_thumb_ul.find("span").remove()}};n.init()});
