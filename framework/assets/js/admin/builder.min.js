JSON.stringify=JSON.stringify||function(e){var t=typeof e;if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var i,a,n=[],r=e&&e.constructor==Array;for(i in e)a=e[i],t=typeof a,"string"==t?a='"'+a+'"':"object"==t&&null!==a&&(a=JSON.stringify(a)),n.push((r?"":'"'+i+'":')+String(a));return(r?"[":"{")+String(n)+(r?"]":"}")},jQuery(document).ready(function(e){var t,i,a={settings:{ID:e("#anva_builder_id").val(),button:e("#anva-builder-button"),checked:e(".anva-builder-enable"),fields:e(".anva-input-builder"),itemUl:e("#builder-sortable-items"),itemLi:e("#builder-sortable-items li"),element:e(".builder-elements li .element-shortcode"),root:e("html, body"),editorHeight:200},init:function(){i=this.settings,a.enable(),a.sortItems(),a.addItem(),a.editItem(),a.moveItem(),a.removeItem(),a.removeAllItems(),a.itemData(),a.publish(),a.tabs(),a.tooltip(),a.importExport(),a.extras()},enable:function(){i.checked.length>0&&(a.checked(i.checked),i.checked.live("change",function(){a.checked(e(this))})),i.button.on("click",function(t){t.preventDefault(),console.log(e(this).serialize()),i.checked.trigger("click")})},checked:function(t){var a=i.button.data("enable"),n=i.button.data("disable");t.is(":checked")?(i.button.text(n),i.fields.slideDown(),e("#"+i.ID).addClass("anva-builder-active"),e("#postdivrich").fadeOut("fast",function(){e(this).css("paddingTop","120px")}),i.root.animate({scrollTop:e("#titlediv").offset().top-32},400)):t.is(":checked")||(i.button.text(a),i.fields.slideUp(),e("#"+i.ID).removeClass("anva-builder-active"),e("#postdivrich").fadeIn("fast",function(){e(this).css("paddingTop","0px")}),i.root.animate({scrollTop:e("#postdivrich").offset().top-32},400))},dragItems:function(){i.element.draggable({connectToSortable:"#builder-sortable-items",revert:"invalid",zIndex:199,helper:function(t){var i=a.buildItem();return e(i.html).addClass("block").css("minWidth","300px")},start:function(e,t){},stop:function(e,t){}})},sortItems:function(){i.itemUl.sortable({handle:".thumbnail",placeholder:"ui-state-highlight",revert:20,cursor:"move",helper:"clone",sort:function(e,t){t.item.removeClass("animated")},receive:function(e,t){},update:function(e,t){}}),i.itemUl.find(".thumbnail").disableSelection()},buildItem:function(){var t=e.now(),i=e("#anva_shortcode").val(),a=e("#anva_shortcode_title").val(),n=e("#anva_shortcode_image").val();if(""!=i){var r={};r.id=t,r.shortcode=i;var o=JSON.stringify(r),l=ANVA.ajaxurl+"?action=anva_builder_get_fields&&shortcode="+i+"&rel="+t;return builderItem='<li id="'+t+'" class="item item-'+t+" "+i+' ui-state-default animated bounceIn">',builderItem+='<div class="actions">',builderItem+='<a href="#" class="button-move-up"></a>',builderItem+='<a href="#" class="button-move-down"></a>',builderItem+='<a href="'+l+'" class="button-edit" data-id="'+t+'"></a>',builderItem+='<a href="#" class="button-remove"></a>',builderItem+="</div>",builderItem+='<div class="thumbnail">',builderItem+='<img src="'+n+'" alt="'+a+'" />',builderItem+="</div>",builderItem+='<div class="title">',builderItem+='<span class="shortcode-type">'+a+"</span>",builderItem+='<span class="shortcode-title"></span>',builderItem+="</div>",builderItem+='<span class="spinner spinner-'+t+'"></span>',builderItem+='<div class="clear"></div>',builderItem+="</li>",{id:t,shortcode:i,title:a,image:n,ajax:l,html:builderItem,data:r,json:o}}return!1},addItem:function(){e("#add-builder-item").on("click",function(t){if(t.preventDefault(),e(this).attr("disabled"))return!1;if(""==e("#anva_shortcode").val())return alert(ANVA.builder_empty),!1;var n=a.buildItem();return n?(e(this).attr("disabled","disabled"),i.itemUl.append(n.html),i.itemUl.removeClass("empty"),e("#"+n.id).data("anva_builder_settings",n.json),"divider"!=n.shortcode&&(e("#"+n.id).find(".button-edit").trigger("click"),i.root.animate({scrollTop:e("#"+n.id).offset().top-32},1e3)),"divider"==n.shortcode&&e(this).removeAttr("disabled"),i.element.removeClass("selected"),e("#anva_shortcode").val(""),e("#anva_shortcode_title").val(""),void e("#anva_shortcode_image").val("")):!1})},editItem:function(){e(document).on("click","#builder-sortable-items .actions a.button-edit",function(t){t.preventDefault();var a=e(this).parent(".actions").parent("li"),n=a.attr("id"),r=e("#item-inner-"+n);if(0==r.length){e("#anva_current_item").val(e(this).attr("data-id"));var o=e(this).attr("href");a.find("span.spinner").css("visibility","visible");var l=e.ajax({type:"GET",cache:!1,url:o,data:"",success:function(t){a.append('<div id="item-inner-'+n+'" class="item-inner item-inner-'+n+'" style="display:none;">'+t+"</div>"),e("#"+n).addClass("has-inline-content")}});e.when(l).then(function(){if(e("#item-inner-"+n).slideToggle(),a.find("span.spinner").css("visibility","hidden"),e("#add-builder-item").removeAttr("disabled"),e(".colorpicker").wpColorPicker(),e(".anva-wp-editor").length>0){var t={mceInit:{height:i.editorHeight}};e(".anva-wp-editor").wp_editor(t)}e(".rangeslider").live("change",function(){var t,i;t=e(this),width=t.width(),i=(t.val()-t.attr("min"))/(t.attr("max")-t.attr("min")),t.next("output").text(t.val())}).trigger("change"),i.root.animate({scrollTop:e("#"+n).offset().top-32},1e3)})}else e("#item-inner-"+n).slideToggle()})},moveItem:function(){i.itemLi.find("a.button-move-down").on("click",function(t){t.preventDefault();var i=e(this).parent(".actions").parent("li").attr("id"),a=e("#"+i).next().attr("id");e("#"+a).insertBefore("#"+i)}),i.itemLi.find("a.button-move-up").on("click",function(t){t.preventDefault();var i=e(this).parent(".actions").parent("li").attr("id"),a=e("#"+i).prev().attr("id");e("#"+a).insertAfter("#"+i)})},removeItem:function(){e(document).on("click","#builder-sortable-items a.button-remove",function(t){t.preventDefault();var i=e(this).parent(".actions").parent("li");confirm(ANVA.builder_remove)&&(i.fadeOut(),setTimeout(function(){i.remove(),0==e("#builder-sortable-items li").length&&e("#builder-sortable-items").addClass("empty")},500))})},removeAllItems:function(){e(document).on("click","#remove-all-items",function(t){return t.preventDefault(),0==e("#builder-sortable-items li").length?(alert(ANVA.builder_remove_empty),!1):void(confirm(ANVA.builder_remove_all)&&(e("#builder-sortable-items li").remove(),setTimeout(function(){0==e("#builder-sortable-items li").length&&e("#builder-sortable-items").addClass("empty")},500)))})},itemData:function(){i.element.on("click",function(t){t.preventDefault(),i.element.removeClass("selected"),e(this).addClass("selected");var a=e(this).data("element"),n=e(this).data("title"),r=e(this).find("img").attr("src");e("#anva_shortcode").val(a),e("#anva_shortcode_title").val(n),e("#anva_shortcode_image").val(r)})},publish:function(){e("#publish").on("click",function(){e("#builder-sortable-items li").length>0&&(e("#builder-sortable-items li").each(function(){e(this).append('<textarea style="display:none" name="'+i.ID+"["+e(this).attr("id")+'][data]">'+e(this).data("anva_builder_settings")+"</textarea>")}),e("#anva_shortcode_order").val(i.itemUl.sortable("toArray"))),e("#anva-import").val(""),e("#anva-export").val("")})},tabs:function(){e("#elements-wrapper").tabs({hide:{effect:"fade",duration:100},show:{effect:"fade",duration:100}})},tooltip:function(){e(".tooltip").tooltipster({animation:"grow",delay:200,maxWidth:200,theme:"tooltipster-light",touchDevices:!0,trigger:"hover"}),e(".anva-tooltip-info").tooltipster({animation:"fade",delay:200,maxWidth:400,theme:"tooltipster-white",touchDevices:!0,trigger:"hover",position:"bottom-right",content:e(".anva-tooltip-info-html").html(),contentAsHTML:!0})},importExport:function(){e(".anva-backup-container > a").on("click",function(t){t.preventDefault(),e(".anva-backup-container").toggleClass("active")}),e(document).on("click",".button-export",function(t){e("#builder-sortable-items li").each(function(){e(this).hasClass("item-unsaved")&&(alert(ANVA.builder_unsave),t.preventDefault())}),e("#anva-export").val(1)}),e(document).on("click",".button-import",function(t){""==e("#anva-import-file").val()&&(alert(ANVA.builder_import),t.preventDefault()),e(".wrap > form").attr("enctype","multipart/form-data"),e("#anva-import").val(1)})},extras:function(){e("#"+i.ID).addClass("anva-builder"),e(document).on("click","#builder-sortable-items li",function(){e("#anva_current_item").val(e(this).attr("id"))}),e(document).on("click",".anva-remove-image",function(t){t.preventDefault(),e(this).parent(".screenshot").prev().trigger("click")}),e(document).on("click",".anva-upload-button",function(i){i.preventDefault();var a=e(this).data("id"),n=e("#"+a+"_button"),r=e("#"+a+"_image"),o=n.data("remove"),l=n.data("upload");if(o==n.text())e("#"+a).val(""),r.slideUp("fast"),n.text(l),n.removeClass("remove-image"),setTimeout(function(){r.find("img").remove(),r.find("a").remove()},500);else if(l==n.text()){if(t)return void t.open();t=wp.media({title:ANVA.builder_upload,button:{text:ANVA.builder_select_image,close:!1},multiple:!1}),t.on("select",function(){attachment=t.state().get("selection").first().toJSON(),e("#"+a).val(attachment.url),r.append('<img src="'+attachment.url+'" /><a href="#" class="anva-remove-image">X</a>').slideDown("fast"),n.text(o),n.addClass("remove-image"),t.close()}),t.open()}})}};a.init()});
