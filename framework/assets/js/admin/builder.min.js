JSON.stringify=JSON.stringify||function(t){var e=typeof t;if("object"!=e||null===t)return"string"==e&&(t='"'+t+'"'),String(t);var i,a,n=[],r=t&&t.constructor==Array;for(i in t)a=t[i],e=typeof a,"string"==e?a='"'+a+'"':"object"==e&&null!==a&&(a=JSON.stringify(a)),n.push((r?"":'"'+i+'":')+String(a));return(r?"[":"{")+String(n)+(r?"]":"}")},jQuery(document).ready(function(t){var e={init:function(){e.enable(),e.sortItems(),e.addItem(),e.editItem(),e.moveItem(),e.removeItem(),e.removeAllItems(),e.itemData(),e.publish(),e.tabs(),e.tooltip(),e.importExport(),e.extras()},enable:function(){var i=t(".anva-builder-enable");i.length>0&&(e.checked(i),i.live("change",function(){e.checked(i)})),t("#anva-builder-button").on("click",function(t){t.preventDefault(),i.trigger("click")})},checked:function(e){var i=t("#anva-builder-button"),a=i.data("enable"),n=i.data("disable");e.is(":checked")?(i.text(n),i.toggleClass("anva-builder-active",!0),t(".anva-input-builder").slideDown(),t("#postdivrich").fadeOut("fast",function(){t(this).css("paddingTop","80px")})):e.is(":checked")||(i.text(a),i.toggleClass("anva-builder-active",!1),t(".anva-input-builder").slideUp(),t("#postdivrich").fadeIn("fast",function(){t(this).css("paddingTop","0px")}))},sortItems:function(){var e=t(".builder-sortable-items");e.sortable({handle:".thumbnail",placeholder:"ui-state-highlight",revert:!0}),e.find(".thumbnail").disableSelection()},addItem:function(){t("#add-builder-item").on("click",function(e){if(e.preventDefault(),t(this).attr("disabled","disabled"),""==t("#anva_shortcode").val())return alert(ANVA.builder_empty),!1;var i=t.now(),a=t("#anva_shortcode").val(),n=t("#anva_shortcode_title").val(),r=t("#anva_shortcode_image").val();if(""!=a){var l={};l.id=i,l.shortcode=a,l.text_title=n,l.text_content="",l.header_content="";var o=JSON.stringify(l),s=ANVA.ajaxurl+"?action=anva_builder_get_fields&&shortcode="+a+"&rel="+i;builderItem='<li id="'+i+'" class="item item-'+i+" "+a+' ui-state-default animated bounceIn">',builderItem+='<div class="actions">',builderItem+='<a href="'+s+'" class="button-edit" data-id="'+i+'"></a>',builderItem+='<a href="#" class="button-remove"></a>',builderItem+="</div>",builderItem+='<div class="thumbnail">',builderItem+='<img src="'+r+'" alt="'+n+'" />',builderItem+="</div>",builderItem+='<div class="title">',builderItem+='<span class="shortcode-type">'+n+"</span>",builderItem+='<span class="shortcode-title"></span>',builderItem+="</div>",builderItem+='<span class="spinner spinner-'+i+'"></span>',builderItem+='<input type="hidden" class="anva_setting_columns" value="one_fourth"/>',builderItem+='<div class="clear"></div>',builderItem+="</li>",t("#builder-sortable-items").append(builderItem),t("#builder-sortable-items").removeClass("empty"),t("#"+i).data("anva_builder_settings",o),"divider"!=a&&t("#"+i).find(".button-edit").trigger("click"),t(".builder-elements li").removeClass("selected"),t("#anva_shortcode").val(""),t("#anva_shortcode_title").val(""),t("#anva_shortcode_image").val(""),t("html, body").animate({scrollTop:t("#"+i).offset().top-32},1e3)}})},editItem:function(){t(document).on("click","#builder-sortable-items li .actions a.button-edit",function(e){e.preventDefault();var i=t(this).parent(".actions").parent("li"),a=i.attr("id"),n=t("#item-inner-"+a);if(0==n.length){t("#anva_current_item").val(t(this).attr("data-id"));var r=t(this).attr("href");i.find("span.spinner").css("visibility","visible");var l=t.ajax({type:"GET",cache:!1,url:r,data:"",success:function(e){i.append('<div id="item-inner-'+a+'" class="item-inner item-inner-'+a+'" style="display:none;">'+e+"</div>"),t("#"+a).addClass("has-inline-content")}});t.when(l).then(function(){t("#item-inner-"+a).slideToggle(),i.find("span.spinner").css("visibility","hidden"),t("#add-builder-item").removeAttr("disabled"),t(".colorpicker").wpColorPicker();var e={mceInit:{height:200}};t(".anva-wp-editor").wp_editor(e),t(".rangeslider").change(function(){var e,i;e=t(this),width=e.width(),i=(e.val()-e.attr("min"))/(e.attr("max")-e.attr("min")),e.next("output").text(e.val())}).trigger("change"),t("html, body").animate({scrollTop:t("#"+a).offset().top-32},1e3)})}else t("#item-inner-"+a).slideToggle()})},moveItem:function(){t("#builder-sortable-items li a.button-move-down").on("click",function(e){e.preventDefault();var i=t(this).parent(".actions").parent("li").attr("id"),a=t("#"+i).next().attr("id");t("#"+a).insertBefore("#"+i)}),t("#builder-sortable-items li a.button-move-up").on("click",function(e){e.preventDefault();var i=t(this).parent(".actions").parent("li").attr("id"),a=t("#"+i).prev().attr("id");t("#"+a).insertAfter("#"+i)})},removeItem:function(){t(document).on("click","#builder-sortable-items li a.button-remove",function(e){e.preventDefault();var i=t(this).parent(".actions").parent("li");confirm("Are you sure you want to delete this item?")&&(i.remove(),setTimeout(function(){0==t("#builder-sortable-items li").length&&t("#builder-sortable-items").addClass("empty")},500))})},removeAllItems:function(){t(document).on("click","#remove-all-items",function(e){e.preventDefault();var i=t("#builder-sortable-items li");confirm("Are you sure you want to delete all items?")&&(i.remove(),setTimeout(function(){0==t("#builder-sortable-items li").length&&t("#builder-sortable-items").addClass("empty")},500))})},itemData:function(){var e=t(".builder-elements li");e.on("click",function(i){i.preventDefault(),e.removeClass("selected"),t(this).addClass("selected");var a=t(this).data("element"),n=t(this).data("title"),r=t(this).find("img").attr("src");t("#anva_shortcode").val(a),t("#anva_shortcode_title").val(n),t("#anva_shortcode_image").val(r)})},publish:function(){t("#publish").on("click",function(){if(t("#builder-sortable-items li").length>0){var e=t("#anva_builder_id").val(),i=t("#builder-sortable-items").sortable("toArray");t("#builder-sortable-items li").each(function(){t(this).append('<textarea style="display:none" name="'+e+"["+t(this).attr("id")+'][data]">'+t(this).data("anva_builder_settings")+"</textarea>")}),t("#anva_shortcode_order").val(i)}t("#anva-import").val(""),t("#anva-export").val("")})},tabs:function(){t("#elements-tabs").tabs({hide:{effect:"fade",duration:400},show:{effect:"fade",duration:400}})},tooltip:function(){t(".tooltip").tooltipster({animation:"grow",delay:200,maxWidth:200,theme:"tooltipster-light",touchDevices:!0,trigger:"hover"}),t(".anva-tooltip-info").on("click",function(e){t(this).tooltipster({animation:"fade",delay:200,maxWidth:400,theme:"tooltipster-white",touchDevices:!0,trigger:"hover",position:"bottom-right",content:t(".anva-tooltip-info-html").html(),contentAsHTML:!0}),e.preventDefault()})},importExport:function(){t(".anva-backup-container > a").on("click",function(e){e.preventDefault(),t(".anva-backup-container").toggleClass("active")}),t(document).on("click",".button-export",function(e){t("#builder-sortable-items li").each(function(){t(this).hasClass("item-unsaved")&&(alert(ANVA.builder_unsave),e.preventDefault())}),t("#anva-export").val(1)}),t(document).on("click",".button-import",function(e){""==t("#anva-import-file").val()&&(alert(ANVA.builder_import),e.preventDefault()),t(".wrap > form").attr("enctype","multipart/form-data"),t("#anva-import").val(1)})},extras:function(){var e=t("#anva_builder_id").val();t("#"+e).addClass("anva-builder"),t(document).on("click","#builder-sortable-items li",function(){t("#anva_current_item").val(t(this).attr("id"))}),t(document).on("click","anva-upload-button",function(e){var i=t(this).attr("rel"),a=wp.media.editor.send.attachment;return wp.media.editor.send.attachment=function(e,n){t("#"+i).attr("value",n.url),t('<img src="'+n.url+'" />').insertAfter("#"+i+"_button"),wp.media.editor.send.attachment=a},wp.media.editor.open(),!1})}};e.init()});
