var ANVAMETA=ANVAMETA||{};!function(e){"use strict";ANVAMETA.initialize={init:function(){ANVAMETA.initialize.change(),ANVAMETA.initialize.enable(),ANVAMETA.initialize.tabs()},change:function(){var t=e("#page_template");t.length>0&&(ANVAMETA.initialize.validate(t.val()),t.live("change",function(){ANVAMETA.initialize.validate(e(this).val())}))},enable:function(){var t=e(".enable-builder");t.length>0&&(ANVAMETA.initialize.enableCheck(t),t.live("change",function(){ANVAMETA.initialize.enableCheck(t)}))},enableCheck:function(t){t.is(":checked")?(e(".meta-content-builder, .meta-content-builder-export").fadeIn(),e("#postdivrich").fadeOut()):(e(".meta-content-builder, .meta-content-builder-export").fadeOut(),e("#postdivrich").fadeIn())},validate:function(t){var a=e("#meta-grid_column"),n=e("#meta-sidebar_layout");"template_grid.php"==t?a.show():a.hide(),"default"==t||"template_list.php"==t||"template_archives.php"==t||"template_grid.php"==t?n.show():n.hide()},tabs:function(){e(".nav-tab-wrapper").length>0&&ANVAMETA.initialize.navTabs()},navTabs:function(){var t=e(".meta-group"),a=e(".nav-tab-wrapper a"),n="";t.hide(),"undefined"!=typeof localStorage&&(n=localStorage.getItem("meta_active_tab")),""!=n&&e(n).length?(e(n).fadeIn(),e(n+"-tab").addClass("nav-tab-active")):(e(".meta-group:first").fadeIn(),e(".nav-tab-wrapper a:first").addClass("nav-tab-active")),a.click(function(n){n.preventDefault(),a.removeClass("nav-tab-active"),e(this).addClass("nav-tab-active").blur(),"undefined"!=typeof localStorage&&localStorage.setItem("meta_active_tab",e(this).attr("href"));var i=e(this).attr("href");t.hide(),e(i).fadeIn()})}},ANVAMETA.widgets={init:function(){ANVAMETA.widgets.picker(),ANVAMETA.widgets.repeatable()},picker:function(){e(".meta-date-picker").length>0&&e(".meta-date-picker").datepicker()},repeatable:function(){e(".field-repeatable").length>0&&(e(".repeatable-add").click(function(){return field=e(this).closest(".meta-controls").find(".custom_repeatable li:last").clone(!0),fieldLocation=e(this).closest(".meta-controls").find(".custom_repeatable li:last"),e("input",field).val("").attr("name",function(e,t){return t.replace(/(\d+)/,function(e,t){return Number(t)+1})}),field.insertAfter(fieldLocation,e(this).closest(".meta-controls")),!1}),e(".repeatable-remove").click(function(){var t=e(":input[id^=custom_repeatable]").length;return 1!==t?(e(this).parent().remove(),!1):void 0}),e(".custom_repeatable").length>0&&e(".custom_repeatable").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort"}))}},ANVAMETA.documentOnReady={init:function(){ANVAMETA.initialize.init(),ANVAMETA.widgets.init()}},e(document).ready(ANVAMETA.documentOnReady.init)}(jQuery),jQuery(function(e){if("undefined"!=typeof plupload&&"undefined"!=typeof ANVAUploaderInit){var t=new plupload.Uploader(ANVAUploaderInit);t.init(),t.bind("FilesAdded",function(e){e.start(),jQuery("#anva_gallery_spinner").css("display","block")}),t.bind("FileUploaded",function(e,a,i){var l=t.total.queued<1?function(){jQuery("#anva_gallery_spinner").hide()}:function(){};"undefined"!=typeof i.response&&n.get_thumbnail(i.response,l)})}else jQuery("#anva-plupload-browse-button").hide();var a,n={admin_thumb_ul:"",admin_thumb_ul_li:"",init:function(){this.admin_thumb_ul=jQuery("#anva_gallery_thumbs"),this.admin_thumb_ul_li=jQuery("#anva_gallery_thumbs li"),this.admin_thumb_ul.sortable({placeholder:"anva_gallery_placeholder"}),this.admin_thumb_ul.on("click",".anva_gallery_remove",function(){return jQuery(this).parent().fadeOut(100,function(){jQuery(this).remove()}),setTimeout(function(){n.empty_gallery()},500),!1}),jQuery("#anva_gallery_upload_button").on("click",function(e){return e.preventDefault(),a?void a.open():(a=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!0}),a.on("select",function(){for(var e=a.state().get("selection").toJSON(),t=e.length,i=0;t>i;i++)n.get_thumbnail(e[i].id)}),void a.open())}),jQuery("#anva_gallery_add_attachments_button").on("click",function(){var e=[];jQuery("#anva_gallery_thumbs input[type=hidden]").each(function(t,a){e.push(jQuery(this).val())}),n.get_all_thumbnails(POST_ID,e)}),jQuery("#anva_gallery_delete_all_button").on("click",function(){return 0==jQuery("#anva_gallery_thumbs li").length?void alert("The box is empty, add some image first."):(confirm("Are you sure you want to delete all the images in the gallery?")&&n.admin_thumb_ul.empty(),n.empty_gallery(),!1)}),n.empty_gallery()},get_thumbnail:function(e,t){t=t||function(){};var a={action:"anva_gallery_get_thumbnail",imageid:e};jQuery("#anva_gallery_spinner").css("display","block"),jQuery.post(ajaxurl,a,function(e){n.admin_thumb_ul.append(e),t(),n.empty_gallery()}).done(function(){jQuery("#anva_gallery_spinner").hide()})},get_all_thumbnails:function(e,t){var a={action:"anva_gallery_get_all_thumbnail",post_id:e,included:t};jQuery("#anva_gallery_spinner").css("display","block"),jQuery.post(ajaxurl,a,function(e){n.admin_thumb_ul.append(e),n.empty_gallery()}).done(function(){jQuery("#anva_gallery_spinner").hide()})},empty_gallery:function(){this.admin_thumb_ul=jQuery("#anva_gallery_thumbs"),this.admin_thumb_ul_li=jQuery("#anva_gallery_thumbs li"),0==this.admin_thumb_ul_li.length?(this.admin_thumb_ul.find("span").remove(),this.admin_thumb_ul.append("<span>No images have been selected yet.<span>")):this.admin_thumb_ul.find("span").remove()}};n.init()});
