var ANVAMETA=ANVAMETA||{};!function(e){"use strict";ANVAMETA.initialize={init:function(){ANVAMETA.initialize.change(),ANVAMETA.initialize.enable(),ANVAMETA.initialize.tabs()},change:function(){var t=e("#page_template");t.length>0&&(ANVAMETA.initialize.validate(t.val()),t.live("change",function(){ANVAMETA.initialize.validate(e(this).val())}))},enable:function(){var t=e(".enable-builder");t.length>0&&(ANVAMETA.initialize.enableCheck(t),t.live("change",function(){ANVAMETA.initialize.enableCheck(t)}))},enableCheck:function(t){t.is(":checked")?(e(".meta-content-builder, .meta-content-builder-export").fadeIn(),e("#postdivrich").fadeOut()):(e(".meta-content-builder, .meta-content-builder-export").fadeOut(),e("#postdivrich").fadeIn())},validate:function(t){var i=e("#meta-grid_column"),a=e("#meta-sidebar_layout");"template_grid.php"==t?i.show():i.hide(),"default"==t||"template_list.php"==t||"template_archives.php"==t||"template_grid.php"==t?a.show():a.hide()},tabs:function(){e(".nav-tab-wrapper").length>0&&ANVAMETA.initialize.navTabs()},navTabs:function(){var t=e(".meta-group"),i=e(".nav-tab-wrapper a"),a="";t.hide(),"undefined"!=typeof localStorage&&(a=localStorage.getItem("meta_active_tab")),""!=a&&e(a).length?(e(a).fadeIn(),e(a+"-tab").addClass("nav-tab-active")):(e(".meta-group:first").fadeIn(),e(".nav-tab-wrapper a:first").addClass("nav-tab-active")),i.click(function(a){a.preventDefault(),i.removeClass("nav-tab-active"),e(this).addClass("nav-tab-active").blur(),"undefined"!=typeof localStorage&&localStorage.setItem("meta_active_tab",e(this).attr("href"));var n=e(this).attr("href");t.hide(),e(n).fadeIn()})}},ANVAMETA.widgets={init:function(){ANVAMETA.widgets.picker()},picker:function(){e(".meta-date-picker").length>0&&e(".meta-date-picker").datepicker()}},ANVAMETA.documentOnReady={init:function(){ANVAMETA.initialize.init(),ANVAMETA.widgets.init()}},e(document).ready(ANVAMETA.documentOnReady.init)}(jQuery),jQuery(function(e){if("undefined"!=typeof plupload&&"undefined"!=typeof ANVAUploaderInit){var t=new plupload.Uploader(ANVAUploaderInit);t.init(),t.bind("FilesAdded",function(e){e.start(),jQuery("#anva_gallery_spinner").css("display","block")}),t.bind("FileUploaded",function(e,i,n){var r=t.total.queued<1?function(){jQuery("#anva_gallery_spinner").hide()}:function(){};"undefined"!=typeof n.response&&a.get_thumbnail(n.response,r)})}else jQuery("#anva-plupload-browse-button").hide();var i,a={admin_thumb_ul:"",admin_thumb_ul_li:"",init:function(){this.admin_thumb_ul=jQuery("#anva_gallery_thumbs"),this.admin_thumb_ul_li=jQuery("#anva_gallery_thumbs li"),this.admin_thumb_ul.length>0&&this.admin_thumb_ul.sortable({placeholder:"anva_gallery_placeholder"}),this.admin_thumb_ul.on("click",".anva_gallery_remove",function(){return jQuery(this).parent().fadeOut(100,function(){jQuery(this).remove()}),setTimeout(function(){a.empty_gallery()},500),!1}),jQuery("#anva_gallery_upload_button").on("click",function(e){return e.preventDefault(),i?void i.open():(i=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!0}),i.on("select",function(){for(var e=i.state().get("selection").toJSON(),t=e.length,n=0;t>n;n++)a.get_thumbnail(e[n].id)}),void i.open())}),jQuery("#anva_gallery_add_attachments_button").on("click",function(){var e=[];jQuery("#anva_gallery_thumbs input[type=hidden]").each(function(t,i){e.push(jQuery(this).val())}),a.get_all_thumbnails(POST_ID,e)}),jQuery("#anva_gallery_delete_all_button").on("click",function(){return 0==jQuery("#anva_gallery_thumbs li").length?void alert("The box is empty, add some image first."):(confirm("Are you sure you want to delete all the images in the gallery?")&&a.admin_thumb_ul.empty(),a.empty_gallery(),!1)}),a.empty_gallery()},get_thumbnail:function(e,t){t=t||function(){};var i={action:"anva_gallery_get_thumbnail",imageid:e};jQuery("#anva_gallery_spinner").css("display","block"),jQuery.post(ajaxurl,i,function(e){a.admin_thumb_ul.append(e),t(),a.empty_gallery()}).done(function(){jQuery("#anva_gallery_spinner").hide()})},get_all_thumbnails:function(e,t){var i={action:"anva_gallery_get_all_thumbnail",post_id:e,included:t};jQuery("#anva_gallery_spinner").css("display","block"),jQuery.post(ajaxurl,i,function(e){a.admin_thumb_ul.append(e),a.empty_gallery()}).done(function(){jQuery("#anva_gallery_spinner").hide()})},empty_gallery:function(){this.admin_thumb_ul=jQuery("#anva_gallery_thumbs"),this.admin_thumb_ul_li=jQuery("#anva_gallery_thumbs li"),0==this.admin_thumb_ul_li.length?(this.admin_thumb_ul.find("span").remove(),this.admin_thumb_ul.append("<span>No images have been selected yet.<span>")):this.admin_thumb_ul.find("span").remove()}};a.init()});
