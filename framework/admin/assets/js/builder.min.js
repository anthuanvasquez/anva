JSON.stringify=JSON.stringify||function(t){var e=typeof t;if("object"!=e||null===t)return"string"==e&&(t='"'+t+'"'),String(t);var a,n,i=[],o=t&&t.constructor==Array;for(a in t)n=t[a],e=typeof n,"string"==e?n='"'+n+'"':"object"==e&&null!==n&&(n=JSON.stringify(n)),i.push((o?"":'"'+a+'":')+String(n));return(o?"[":"{")+String(i)+(o?"]":"}")},jQuery(document).ready(function(t){"use strict";var e,a,n={settings:{ID:t("#anva_builder_id").val(),button:t("#anva-builder-button"),checked:t(".anva-builder-enable"),fields:t(".anva-input-builder"),itemUl:t("#builder-sortable-items"),itemLi:t("#builder-sortable-items li"),element:t(".builder-elements li .element-shortcode"),root:t("html, body"),editorHeight:200},init:function(){a=this.settings,n.enable(),n.sortItems(),n.addItem(),n.editItem(),n.moveItem(),n.removeItem(),n.removeAllItems(),n.itemData(),n.publish(),n.tabs(),n.tooltip(),n.importExport(),n.extras()},enable:function(){a.checked.length>0&&(n.checked(a.checked),a.checked.live("change",function(){n.checked(t(this))})),a.button.on("click",function(t){t.preventDefault(),a.checked.trigger("click")})},checked:function(e){var n=a.button.data("enable"),i=a.button.data("disable");e.is(":checked")?(a.button.text(i),a.fields.slideDown(),t("#"+a.ID).addClass("anva-builder-active"),t("#minor-publishing-actions").hide(),t("#postdivrich").fadeOut("fast",function(){t(this).css("paddingTop","120px")}),t("#"+a.ID).hasClass("anva-builder-active")&&(console.log(t("#"+a.ID)),t("#publish").val(anvaJs.builder_publish_items)),a.root.animate({scrollTop:t("#titlediv").offset().top-32},400)):e.is(":checked")||(a.button.text(n),a.fields.slideUp(),t("#"+a.ID).removeClass("anva-builder-active"),t("#minor-publishing-actions").show(),t("#postdivrich").fadeIn("fast",function(){t(this).css("paddingTop","0px")}),t("#"+a.ID).hasClass("anva-builder-active")||t("#publish").val(anvaJs.builder_publish_update),a.root.animate({scrollTop:t("#postdivrich").offset().top-32},400))},dragItems:function(){a.element.draggable({connectToSortable:"#builder-sortable-items",revert:"invalid",zIndex:199,helper:function(){var e=n.buildItem();return t(e.html).addClass("block").css("minWidth","300px")},start:function(){},stop:function(){}})},sortItems:function(){a.itemUl.sortable({handle:".thumbnail",placeholder:"ui-state-highlight",revert:20,cursor:"move",helper:"clone",sort:function(t,e){e.item.removeClass("animated")},receive:function(){},update:function(){}}),a.itemUl.find(".thumbnail").disableSelection()},buildItem:function(){var e=t.now(),a=t("#anva_shortcode").val(),n=t("#anva_shortcode_title").val(),i=t("#anva_shortcode_image").val();if(""!=a){var o={};o.id=e,o.shortcode=a;var s,l=JSON.stringify(o),c=anvaJs.ajaxurl+"?action=anva_builder_get_fields&&shortcode="+a+"&rel="+e;return s='<li id="'+e+'" class="item item-'+e+" "+a+' ui-state-default animated bounceIn">',s+='<div class="actions">',s+='<a href="#" class="button-move-up"></a>',s+='<a href="#" class="button-move-down"></a>',s+='<a href="'+c+'" class="button-edit" data-id="'+e+'"></a>',s+='<a href="#" class="button-remove"></a>',s+="</div>",s+='<div class="thumbnail">',s+='<img src="'+i+'" alt="'+n+'" />',s+="</div>",s+='<div class="title">',s+='<span class="shortcode-type">'+n+"</span>",s+='<span class="shortcode-title"></span>',s+="</div>",s+='<span class="spinner spinner-'+e+'"></span>',s+='<div class="clear"></div>',s+="</li>",{id:e,shortcode:a,title:n,image:i,ajax:c,html:s,data:o,json:l}}return!1},addItem:function(){t("#add-builder-item").on("click",function(e){if(e.preventDefault(),t(this).attr("disabled"))return!1;if(""==t("#anva_shortcode").val())return swal({title:"Builder",text:anvaJs.builder_empty,type:"info",showConfirmButton:!0,confirmButtonColor:"#0085ba"}),!1;var i=n.buildItem();return i?(t(this).attr("disabled","disabled"),a.itemUl.append(i.html),a.itemUl.removeClass("empty"),t("#"+i.id).data("anva_builder_settings",i.json),"divider"!=i.shortcode&&(t("#"+i.id).find(".button-edit").trigger("click"),a.root.animate({scrollTop:t("#"+i.id).offset().top-32},1e3)),"divider"==i.shortcode&&t(this).removeAttr("disabled"),a.element.removeClass("selected"),t("#anva_shortcode").val(""),t("#anva_shortcode_title").val(""),void t("#anva_shortcode_image").val("")):!1})},editItem:function(){t(document).on("click","#builder-sortable-items .actions a.button-edit",function(e){e.preventDefault();var n=t(this).parent(".actions").parent("li"),i=n.attr("id"),o=t("#item-inner-"+i);if(0==o.length){t("#anva_current_item").val(t(this).attr("data-id"));var s=t(this).attr("href");n.find("span.spinner").css("visibility","visible");var l=t.ajax({type:"GET",cache:!1,url:s,data:"",success:function(e){n.append('<div id="item-inner-'+i+'" class="item-inner item-inner-'+i+'" style="display:none;">'+e+"</div>"),t("#"+i).addClass("has-inline-content")}});t.when(l).then(function(){if(t("#item-inner-"+i).slideToggle(),n.find("span.spinner").css("visibility","hidden"),t("#add-builder-item").removeAttr("disabled"),t(".colorpicker").wpColorPicker(),t(".anva-wp-editor").length>0){var e={mceInit:{height:a.editorHeight}};t(".anva-wp-editor").wp_editor(e)}t(".rangeslider").on("mousemove",function(){var e=t(this);e.next("output").text(e.val())}).trigger("mousemove"),a.root.animate({scrollTop:t("#"+i).offset().top-32},1e3)})}else t("#item-inner-"+i).slideToggle()})},moveItem:function(){a.itemLi.find("a.button-move-down").on("click",function(e){e.preventDefault();var a=t(this).parent(".actions").parent("li").attr("id"),n=t("#"+a).next().attr("id");t("#"+n).insertBefore("#"+a)}),a.itemLi.find("a.button-move-up").on("click",function(e){e.preventDefault();var a=t(this).parent(".actions").parent("li").attr("id"),n=t("#"+a).prev().attr("id");t("#"+n).insertAfter("#"+a)})},removeItem:function(){t(document).on("click","#builder-sortable-items a.button-remove",function(e){e.preventDefault();var a=t(this).parent(".actions").parent("li");confirm(anvaJs.builder_remove)&&(a.fadeOut(),setTimeout(function(){a.remove(),0==t("#builder-sortable-items li").length&&t("#builder-sortable-items").addClass("empty")},500))})},removeAllItems:function(){t(document).on("click","#remove-all-items",function(e){return e.preventDefault(),0==t("#builder-sortable-items li").length?(swal({title:"Builder",text:anvaJs.builder_remove_empty,type:"info",showConfirmButton:!0,confirmButtonColor:"#0085ba"}),!1):void swal({title:"Builder",text:anvaJs.builder_remove_all,type:"warning",showCancelButton:!0,confirmButtonColor:"#0085ba",confirmButtonText:anvaJs.confirm,cancelButtonText:anvaJs.cancel,cancelButtonColor:"#f7f7f7",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(t("#builder-sortable-items li").remove(),setTimeout(function(){0==t("#builder-sortable-items li").length&&t("#builder-sortable-items").addClass("empty")},500))})})},itemData:function(){a.element.on("click",function(e){e.preventDefault(),a.element.removeClass("selected"),t(this).addClass("selected");var n=t(this).data("element"),i=t(this).data("title"),o=t(this).find("img").attr("src");t("#anva_shortcode").val(n),t("#anva_shortcode_title").val(i),t("#anva_shortcode_image").val(o)})},publish:function(){t("#publish").on("click",function(){t("#builder-sortable-items li").length>0&&(t("#builder-sortable-items li").each(function(){t(this).append('<textarea style="display:none" name="'+a.ID+"["+t(this).attr("id")+'][data]">'+t(this).data("anva_builder_settings")+"</textarea>")}),t("#anva_shortcode_order").val(a.itemUl.sortable("toArray"))),t("#anva-import").val(""),t("#anva-export").val("")})},tabs:function(){t("#elements-wrapper").tabs({hide:{effect:"fade",duration:100},show:{effect:"fade",duration:100}})},tooltip:function(){t(".tooltip").tooltipster({animation:"grow",delay:200,maxWidth:200,theme:"tooltipster-light",touchDevices:!0,trigger:"hover"}),t(".anva-tooltip-info").tooltipster({animation:"fade",delay:200,maxWidth:400,theme:"tooltipster-white",touchDevices:!0,trigger:"hover",position:"bottom-right",content:t(".anva-tooltip-info-html").html(),contentAsHTML:!0})},importExport:function(){t(".anva-backup-container > a").on("click",function(e){e.preventDefault(),t(".anva-backup-container").toggleClass("active")}),t(document).on("click",".button-export",function(e){t("#builder-sortable-items li").each(function(){t(this).hasClass("item-unsaved")&&(alert(anvaJs.builder_unsave),e.preventDefault())}),t("#anva-export").val(1)}),t(document).on("click",".button-import",function(e){""==t("#anva-import-file").val()&&(alert(anvaJs.builder_import),e.preventDefault()),t(".wrap > form").attr("enctype","multipart/form-data"),t("#anva-import").val(1)})},extras:function(){t("#"+a.ID).addClass("anva-builder"),t(document).on("click","#builder-sortable-items li",function(){t("#anva_current_item").val(t(this).attr("id"))}),t(document).on("click",".anva-remove-image",function(e){e.preventDefault(),t(this).parent(".screenshot").prev().trigger("click")}),t(document).on("click",".anva-upload-button",function(a){a.preventDefault();var n=t(this).data("id"),i=t("#"+n+"_button"),o=t("#"+n+"_image"),s=i.data("remove"),l=i.data("upload");if(s==i.text())t("#"+n).val(""),o.slideUp("fast"),i.text(l),i.removeClass("remove-image"),setTimeout(function(){o.find("img").remove(),o.find("a").remove()},500);else if(l==i.text()){if(e)return void e.open();e=wp.media({title:anvaJs.builder_upload,button:{text:anvaJs.builder_select_image,close:!1},multiple:!1}),e.on("select",function(){var a=e.state().get("selection").first().toJSON();t("#"+n).val(a.url),o.append('<img src="'+a.url+'" /><a href="#" class="anva-remove-image">X</a>').slideDown("fast"),i.text(s),i.addClass("remove-image"),e.close()}),e.open()}})}};n.init()});
